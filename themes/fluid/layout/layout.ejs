<%
var banner_img_height = parseFloat(page.banner_img_height || theme.index.banner_img_height)
var colorSchema = theme.dark_mode && theme.dark_mode.enable && theme.dark_mode.default ? theme.dark_mode.default : ''
%>

<!DOCTYPE html>
<html lang="<%= config.language %>" <%= colorSchema ? `data-default-color-scheme=${colorSchema}` : '' %>>

<%- partial('_partials/head.ejs') %>

<body>
  <%- inject_point('bodyBegin') %>

  <header>
    <%- inject_point('header') %>
  </header>

  <main>
    <% if(is_post() || page.layout === '404') { %>
      <%- body %>
    <% } else { %>
      <div class="container nopadding-x-md">
        <div id="board"
          <%- banner_img_height >= 100 && theme.banner && theme.banner.parallax ? 'style="margin-top: 0"' : '' %>>
          <% if(page.layout === 'about') { %>
            <div class="about-avatar">
              <img src="<%= url_for(theme.about.avatar) %>" class="img-fluid" alt="avatar">
            </div>
          <% } %>
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                <%- body %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% } %>

    <% if (theme.scroll_top_arrow.enable) { %>
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    <% } %>

    <% if (theme.search.enable) { %>
      <%- partial('_partials/search.ejs') %>
    <% } %>

    <% if (theme.custom_html) { %>
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <%- theme.custom_html %>
        </div>
      </div>
    <% } %>
  </main>

  <footer>
    <%- inject_point('footer') %>
  </footer>

  <!-- Scripts -->
  <%- partial('_partials/scripts.ejs') %>

  <%- inject_point('bodyEnd') %>

  <noscript>
    <div class="noscript-warning"><%- __('noscript_warning') %></div>
  </noscript>

<!-- 3. 博文内容区域 静态浅灰色网格（安全版本，不覆盖内容） -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  // 仅在博文页面显示
  const contentContainer = document.querySelector('.post-content');
  if (!contentContainer) return;

  // 创建canvas元素
  const canvas = document.createElement('canvas');
  canvas.id = 'gridCanvas';
  canvas.style.cssText = `
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
    background: transparent;
    pointer-events: none;
    opacity: 0.3;
  `;
  
  // 确保内容容器有相对定位
  const originalPosition = contentContainer.style.position;
  contentContainer.style.position = 'relative';
  
  // 将canvas插入到内容容器的最前面（作为背景）
  contentContainer.insertBefore(canvas, contentContainer.firstChild);
  
  const ctx = canvas.getContext('2d');
  let width, height;
  const gap = 30;

  function resizeCanvas() {
    const rect = contentContainer.getBoundingClientRect();
    width = rect.width;
    height = rect.height;
    
    // 设置canvas的实际像素尺寸
    canvas.width = width;
    canvas.height = height;
    
    drawGrid();
  }

  function drawGrid() {
    ctx.clearRect(0, 0, width, height);
    ctx.strokeStyle = 'rgba(200, 200, 200, 0.5)';
    ctx.lineWidth = 0.5;

    // 横线
    for (let y = 0; y < height; y += gap) {
      ctx.beginPath();
      ctx.moveTo(0, y);
      ctx.lineTo(width, y);
      ctx.stroke();
    }

    // 竖线
    for (let x = 0; x < width; x += gap) {
      ctx.beginPath();
      ctx.moveTo(x, 0);
      ctx.lineTo(x, height);
      ctx.stroke();
    }
  }

  // 使用ResizeObserver监听尺寸变化
  if ('ResizeObserver' in window) {
    const resizeObserver = new ResizeObserver(resizeCanvas);
    resizeObserver.observe(contentContainer);
  } else {
    // 兼容方案
    window.addEventListener('resize', resizeCanvas);
  }
  
  // 初始绘制
  setTimeout(resizeCanvas, 100);
});
</script>

<!-- 确保内容在网格上层的样式 -->
<style>
.post-content > *:not(#gridCanvas) {
  position: relative;
  z-index: 1;
}
</style>
</body>


</html>

