<%
var banner_img_height = parseFloat(page.banner_img_height || theme.index.banner_img_height)
var colorSchema = theme.dark_mode && theme.dark_mode.enable && theme.dark_mode.default ? theme.dark_mode.default : ''
%>

<!DOCTYPE html>
<html lang="<%= config.language %>" <%= colorSchema ? `data-default-color-scheme=${colorSchema}` : '' %>>

<%- partial('_partials/head.ejs') %>

<body>
  <%- inject_point('bodyBegin') %>

  <header>
    <%- inject_point('header') %>
  </header>

  <main>
    <% if(is_post() || page.layout === '404') { %>
      <%- body %>
    <% } else { %>
      <div class="container nopadding-x-md">
        <div id="board"
          <%- banner_img_height >= 100 && theme.banner && theme.banner.parallax ? 'style="margin-top: 0"' : '' %>>
          <% if(page.layout === 'about') { %>
            <div class="about-avatar">
              <img src="<%= url_for(theme.about.avatar) %>" class="img-fluid" alt="avatar">
            </div>
          <% } %>
          <div class="container">
            <div class="row">
              <div class="col-12 col-md-10 m-auto">
                <%- body %>
              </div>
            </div>
          </div>
        </div>
      </div>
    <% } %>

    <% if (theme.scroll_top_arrow.enable) { %>
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    <% } %>

    <% if (theme.search.enable) { %>
      <%- partial('_partials/search.ejs') %>
    <% } %>

    <% if (theme.custom_html) { %>
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          <%- theme.custom_html %>
        </div>
      </div>
    <% } %>
  </main>

  <footer>
    <%- inject_point('footer') %>
  </footer>

  <!-- Scripts -->
  <%- partial('_partials/scripts.ejs') %>

  <%- inject_point('bodyEnd') %>

  <noscript>
    <div class="noscript-warning"><%- __('noscript_warning') %></div>
  </noscript>

<!-- æ”¾åœ¨ _layout.ejs çš„ </body> å‰é¢ -->

<!-- 1. çƒŸèŠ±èƒŒæ™¯ç‰¹æ•ˆï¼ˆä¿ç•™ï¼‰ -->
<canvas id="fireworks" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;background:transparent;"></canvas>
<script>
const c = document.getElementById("fireworks");
const ctx = c.getContext("2d");
function resizeCanvas() {
  c.width = window.innerWidth;
  c.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

class Particle {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.size = Math.random() * 3 + 1;
    this.vx = (Math.random() - 0.5) * 6;
    this.vy = (Math.random() - 0.5) * 6;
    this.color = `rgb(${Math.random()*255|0},${Math.random()*255|0},${Math.random()*255|0})`;
    this.life = 30;
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;
    this.size *= 0.95;
    this.life--;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fill();
  }
}

let particles = [];
document.addEventListener('mousemove', (e) => {
  for (let i = 0; i < 3; i++) {
    particles.push(new Particle(e.clientX, e.clientY));
  }
});

function animateFireworks() {
  ctx.fillStyle = "rgba(0,0,0,0.05)";
  ctx.fillRect(0, 0, c.width, c.height);
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update();
    particles[i].draw();
    if (particles[i].life <= 0) {
      particles.splice(i, 1);
    }
  }
  requestAnimationFrame(animateFireworks);
}
animateFireworks();
</script>

<!-- 2. banner èƒŒæ™¯ï¼ˆå›¾ç‰‡/è§†é¢‘åŒæ¨¡å¼ï¼‰+ hover çƒŸèŠ±ç‰¹æ•ˆï¼ˆä¿ç•™ï¼‰ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const useVideoBanner = true; // true=è§†é¢‘ï¼Œfalse=å›¾ç‰‡
  const banner = document.getElementById('banner');
  if (!banner) return;
  
  if (useVideoBanner) {
    banner.style.background = 'none';
    const video = document.createElement('video');
    video.src = '/video/banner-video.mp4';
    video.autoplay = true;
    video.loop = true;
    video.muted = true;
    video.playbackRate = 0.8;
    video.style.cssText = `position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;`;
    banner.appendChild(video);
    video.addEventListener('error', () => {
      banner.style.background = 'url(/img/default.png) no-repeat center center';
      banner.style.backgroundSize = 'cover';
    });
  } else {
    banner.style.background = 'url(/img/default.png) no-repeat center center';
    banner.style.backgroundSize = 'cover';
  }

  // banner hover çƒŸèŠ±
  const canvas = document.createElement('canvas');
  canvas.id = 'banner-fireworks';
  canvas.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none;background:transparent;";
  banner.appendChild(canvas);
  
  function resizeBannerCanvas() {
    const rect = banner.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    canvas.style.top = `${rect.top}px`;
    canvas.style.left = `${rect.left}px`;
  }
  resizeBannerCanvas();
  window.addEventListener('resize', resizeBannerCanvas);
  
  const ctx2 = canvas.getContext("2d");
  let bannerParticles = [];
  let isHoverBanner = false;
  let hoverX = 0, hoverY = 0;
  
  banner.addEventListener('mouseenter', () => isHoverBanner = true);
  banner.addEventListener('mouseleave', () => isHoverBanner = false);
  banner.addEventListener('mousemove', (e) => {
    const rect = banner.getBoundingClientRect();
    hoverX = e.clientX - rect.left;
    hoverY = e.clientY - rect.top;
  });
  
  function createBannerParticle() {
    if (!isHoverBanner) return;
    const centerX = hoverX;
    const centerY = hoverY;
    for (let i = 0; i < 8; i++) {
      const angle = (i / 8) * Math.PI * 2;
      const distance = Math.random() * 15 + 5;
      bannerParticles.push({
        x: centerX + Math.cos(angle) * distance,
        y: centerY + Math.sin(angle) * distance,
        size: Math.random() * 3 + 2,
        vx: Math.cos(angle) * (Math.random() * 2 + 1),
        vy: Math.sin(angle) * (Math.random() * 2 + 1),
        color: `rgb(${Math.floor(Math.random()*220+35)},${Math.floor(Math.random()*220+35)},${Math.floor(Math.random()*220+35)})`,
        life: Math.random() * 30 + 20
      });
    }
  }
  
  setInterval(createBannerParticle, 100);
  
  function animateBannerFireworks() {
    ctx2.clearRect(0, 0, canvas.width, canvas.height);
    if (isHoverBanner) {
      ctx2.fillStyle = "rgba(0,0,0,0.1)";
      ctx2.fillRect(0, 0, canvas.width, canvas.height);
    }
    
    for (let i = bannerParticles.length - 1; i >= 0; i--) {
      const p = bannerParticles[i];
      ctx2.fillStyle = p.color;
      ctx2.beginPath();
      ctx2.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx2.fill();
      
      p.x += p.vx;
      p.y += p.vy;
      p.size *= 0.97;
      p.life--;
      
      if (p.life <= 0) bannerParticles.splice(i, 1);
    }
    requestAnimationFrame(animateBannerFireworks);
  }
  animateBannerFireworks();
});
</script>


<!-- 4. åšæ–‡æ ‡é¢˜ç‚¹å‡»ç‚¸å¼€ç‰¹æ•ˆï¼ˆä¿ç•™ï¼‰ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // åŒ¹é… Fluid ä¸»é¢˜åšæ–‡æ ‡é¢˜
  const postTitles = document.querySelectorAll('.post-item .post-title a, .post-header .post-title a');
  
  if (postTitles.length === 0) return;
  
  postTitles.forEach(title => {
    title.style.opacity = 1;
    title.addEventListener('click', function(e) {
      const titleText = this.textContent.trim();
      if (!titleText || !this.href) return;
      
      e.preventDefault();
      const targetUrl = this.href;
      const rect = this.getBoundingClientRect();
      
      this.style.opacity = 0;
      
      // ç”Ÿæˆæ–‡å­—ç²’å­
      for (let i = 0; i < titleText.length; i++) {
        for (let j = 0; j < 3; j++) {
          const particle = document.createElement('span');
          particle.textContent = titleText[i];
          particle.style.cssText = `
            position: fixed;
            left: ${rect.left + i * 14 + Math.random() * 8}px;
            top: ${rect.top + Math.random() * 10 - 5}px;
            color: rgb(${Math.random()*255|0},${Math.random()*255|0},${Math.random()*255|0});
            font-size: ${14 + Math.random() * 6}px;
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            transform: rotate(${Math.random() * 30 - 15}deg);
            transition: all 0.5s cubic-bezier(0.17, 0.67, 0.83, 0.67);
          `;
          document.body.appendChild(particle);
          
          setTimeout(() => {
            const angle = Math.random() * Math.PI * 2;
            const distance = 30 + Math.random() * 40;
            particle.style.transform = `translate(${Math.cos(angle)*distance}px, ${Math.sin(angle)*distance}px) rotate(${Math.random()*60-30}deg)`;
            particle.style.opacity = 0;
          }, 30);
          
          setTimeout(() => particle.remove(), 500);
        }
      }
      
      // ç‰¹æ•ˆç»“æŸåè·³è½¬
      setTimeout(() => {
        this.style.opacity = 1;
        window.location.href = targetUrl;
      }, 300);
    });
  });

  window.addEventListener('popstate', function() {
    postTitles.forEach(title => {
      title.style.opacity = 1;
    });
  });
});
</script>
<!-- 5. å¯¼èˆªæ  + Banner æ–‡å­—æ ·å¼ -->
<style>
/* å¯¼èˆªæ å“ç‰Œæ–‡å­—å½©è™¹æ•ˆæœ */
.navbar-brand strong {
  color: #fff !important;
  font-weight: bold !important;
  transition: all 0.3s ease !important;
  position: relative;
  overflow: hidden;
}

.navbar-brand:hover strong {
  background: linear-gradient(90deg, 
    #ff0000, #ff9900, #ffff00, 
    #33cc33, #3366ff, #9933ff, #ff33cc
  ) !important;
  background-size: 300% 100% !important;
  -webkit-background-clip: text !important;
  background-clip: text !important;
  color: transparent !important;
  animation: rainbow 2s linear infinite !important;
  text-shadow: 0 0 10px rgba(255,255,255,0.3) !important;
}

/* å¯¼èˆªé“¾æ¥å½©è™¹æ•ˆæœ */
.nav-link span {
  color: #fff !important;
  transition: all 0.3s ease !important;
  position: relative;
}

.nav-link:hover span {
  background: linear-gradient(90deg, 
    #ff0000, #ff9900, #ffff00, 
    #33cc33, #3366ff, #9933ff, #ff33cc
  ) !important;
  background-size: 300% 100% !important;
  -webkit-background-clip: text !important;
  background-clip: text !important;
  color: transparent !important;
  animation: rainbow 2s linear infinite !important;
  transform: translateY(-1px) !important;
}

/* å½©è™¹åŠ¨ç”» */
@keyframes rainbow {
  0% { background-position: 0% 50%; }
  100% { background-position: 300% 50%; }
}

/* å¯¼èˆªæ åŸºç¡€æ ·å¼ */
.navbar-brand, .nav-link {
  background: none !important;
  color: #fff !important;
}

.navbar-brand:focus strong,
.nav-link:focus span {
  color: #fff !important;
  outline: none !important;
}

/* é¦–é¡µå¤´éƒ¨é“¾æ¥æ ·å¼ */
.index-header a {
  display: inline-block !important;
  transition: opacity 0.3s ease !important;
}

.index-header a:hover {
  opacity: 0.8 !important;
  transform: translateY(-1px) !important;
}

/* Banner é®ç½©å±‚æ ·å¼ */
.banner .mask {
  background-color: rgba(0,0,0,0.4) !important;
  backdrop-filter: blur(2px) !important;
}

/* Banner æ–‡å­—æ ·å¼ */
.banner-text span {
  color: #fff !important;
  font-weight: bold !important;
  text-shadow: 0 0 8px rgba(0,0,0,0.8) !important;
  letter-spacing: 0.5px !important;
}

/* å¯¼èˆªæ ä¸‹æ‹‰èœå•æ ·å¼ */
.dropdown-menu {
  backdrop-filter: blur(10px) !important;
  background: rgba(255,255,255,0.95) !important;
  border: 1px solid rgba(255,255,255,0.2) !important;
  box-shadow: 0 8px 32px rgba(0,0,0,0.1) !important;
}

.dropdown-item:hover {
  background: rgba(102, 126, 234, 0.1) !important;
}

/* ç§»åŠ¨ç«¯å¯¼èˆªèœå•æ ·å¼ */
@media (max-width: 991.98px) {
  .navbar-collapse {
    backdrop-filter: blur(10px) !important;
    background: rgba(255,255,255,0.95) !important;
    border-radius: 10px !important;
    margin-top: 10px !important;
    padding: 15px !important;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1) !important;
  }
  
  .nav-link span {
    color: #333 !important;
  }
}

/* å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ */
.navbar-scrolled {
  backdrop-filter: blur(10px) !important;
  background: rgba(255,255,255,0.95) !important;
  box-shadow: 0 2px 20px rgba(0,0,0,0.1) !important;
}

.navbar-scrolled .navbar-brand strong,
.navbar-scrolled .nav-link span {
  color: #333 !important;
}

.navbar-scrolled .navbar-brand:hover strong,
.navbar-scrolled .nav-link:hover span {
  background: linear-gradient(90deg, 
    #ff0000, #ff9900, #ffff00, 
    #33cc33, #3366ff, #9933ff, #ff33cc
  ) !important;
  background-size: 300% 100% !important;
  -webkit-background-clip: text !important;
  background-clip: text !important;
  color: transparent !important;
}

/* æ´»åŠ¨é“¾æ¥æŒ‡ç¤ºå™¨ */
.nav-link.active span {
  position: relative !important;
}

.nav-link.active span::after {
  content: '';
  position: absolute;
  bottom: -5px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, #667eea, #764ba2) !important;
  border-radius: 2px;
}
</style>

<script>
// å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
document.addEventListener('DOMContentLoaded', function() {
  const navbar = document.querySelector('.navbar');
  if (!navbar) return;
  
  // æ»šåŠ¨ç›‘å¬
  window.addEventListener('scroll', function() {
    if (window.scrollY > 50) {
      navbar.classList.add('navbar-scrolled');
    } else {
      navbar.classList.remove('navbar-scrolled');
    }
  });
  
  // è®¾ç½®å½“å‰æ´»åŠ¨é“¾æ¥
  const currentPath = window.location.pathname;
  const navLinks = document.querySelectorAll('.nav-link');
  
  navLinks.forEach(link => {
    const linkPath = link.getAttribute('href');
    if (linkPath && currentPath.includes(linkPath) && linkPath !== '/') {
      link.classList.add('active');
    }
  });
});
</script>
<!-- 6. èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ï¼ˆå…ç‰ˆæƒéŸ³ä¹ç‰ˆï¼‰ -->
<div id="music-player" style="position:fixed;bottom:20px;right:20px;z-index:1000;">
  <audio id="bg-music" loop style="display:none;">
    <!-- ç²¾é€‰å…ç‰ˆæƒèƒŒæ™¯éŸ³ä¹ï¼ˆå¤šé¦–å¤‡é€‰ï¼‰ -->
    <source src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" type="audio/mpeg" data-name="ç§‘æŠ€æ°›å›´">
    <source src="https://assets.mixkit.co/music/preview/mixkit-driving-ambition-32.mp3" type="audio/mpeg" data-name="è¿›å–ä¹‹å¿ƒ">
    <source src="https://assets.mixkit.co/music/preview/mixkit-gathering-of-the-tribes-174.mp3" type="audio/mpeg" data-name="éƒ¨è½èšä¼š">
    <source src="https://assets.mixkit.co/music/preview/mixkit-sunny-happy-ukulele-117.mp3" type="audio/mpeg" data-name="å¿«ä¹å°¤å…‹é‡Œé‡Œ">
    <source src="https://assets.mixkit.co/music/preview/mixkit-memory-lane-112.mp3" type="audio/mpeg" data-name="è®°å¿†å°å··">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ 
  </audio>
  
  <div id="music-controls" style="display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.95);padding:10px 15px;border-radius:25px;box-shadow:0 8px 32px rgba(0,0,0,0.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2);">
    <button id="music-toggle" style="
      width:40px;height:40px;border-radius:50%;border:none;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color:white;cursor:pointer;font-size:16px;transition:all 0.3s ease;
    " title="æ’­æ”¾/æš‚åœ">â–¶</button>
    
    <div style="flex:1;min-width:120px;">
      <div id="music-info" style="font-size:12px;color:#666;margin-bottom:4px;">èƒŒæ™¯éŸ³ä¹</div>
      <div style="background:#eee;border-radius:3px;height:4px;overflow:hidden;">
        <div id="music-progress" style="height:100%;background:linear-gradient(90deg, #667eea, #764ba2);width:0%;transition:width 0.1s;"></div>
      </div>
    </div>
    
    <div style="display:flex;align-items:center;gap:5px;">
      <button id="prev-music" style="background:none;border:none;cursor:pointer;font-size:12px;color:#666;" title="ä¸Šä¸€é¦–">â®</button>
      <button id="next-music" style="background:none;border:none;cursor:pointer;font-size:12px;color:#666;" title="ä¸‹ä¸€é¦–">â­</button>
      <button id="volume-btn" style="background:none;border:none;cursor:pointer;font-size:14px;color:#666;" title="éŸ³é‡">ğŸ”Š</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const music = document.getElementById('bg-music');
  const toggleBtn = document.getElementById('music-toggle');
  const progressBar = document.getElementById('music-progress');
  const musicInfo = document.getElementById('music-info');
  const volumeBtn = document.getElementById('volume-btn');
  const prevBtn = document.getElementById('prev-music');
  const nextBtn = document.getElementById('next-music');
  
  let isPlaying = false;
  let userInteracted = false;
  let currentTrack = 0;
  const tracks = Array.from(music.querySelectorAll('source'));
  
  console.log(`æ‰¾åˆ° ${tracks.length} é¦–èƒŒæ™¯éŸ³ä¹`);
  
  // æ ‡è®°ç”¨æˆ·å·²äº¤äº’
  function enableAudio() {
    if (!userInteracted) {
      userInteracted = true;
      console.log('ç”¨æˆ·å·²ä¸é¡µé¢äº¤äº’ï¼Œå¯ä»¥æ’­æ”¾éŸ³ä¹');
    }
  }
  
  // ç›‘å¬ç”¨æˆ·äº¤äº’
  document.addEventListener('click', enableAudio);
  document.addEventListener('touchstart', enableAudio);
  document.addEventListener('keydown', enableAudio);
  
  // åˆ‡æ¢åˆ°æŒ‡å®šæ›²ç›®
  function switchTrack(trackIndex) {
    if (trackIndex < 0) trackIndex = tracks.length - 1;
    if (trackIndex >= tracks.length) trackIndex = 0;
    
    currentTrack = trackIndex;
    const track = tracks[currentTrack];
    music.src = track.src;
    musicInfo.textContent = `èƒŒæ™¯éŸ³ä¹ - ${track.getAttribute('data-name')}`;
    
    console.log(`åˆ‡æ¢åˆ°: ${track.getAttribute('data-name')}`);
    
    // å¦‚æœæ­£åœ¨æ’­æ”¾ï¼Œç«‹å³æ’­æ”¾æ–°æ›²ç›®
    if (isPlaying) {
      music.play().catch(error => {
        console.log('è‡ªåŠ¨æ’­æ”¾æ–°æ›²ç›®å¤±è´¥:', error);
      });
    }
  }
  
  // æ›´æ–°æ’­æ”¾è¿›åº¦
  music.addEventListener('timeupdate', function() {
    if (music.duration) {
      const progress = (music.currentTime / music.duration) * 100;
      progressBar.style.width = progress + '%';
    }
  });
  
  // æ’­æ”¾/æš‚åœ
  toggleBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    enableAudio();
    
    if (isPlaying) {
      music.pause();
      isPlaying = false;
      toggleBtn.innerHTML = 'â–¶';
      toggleBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      console.log('éŸ³ä¹å·²æš‚åœ');
    } else {
      if (userInteracted) {
        music.play().then(() => {
          isPlaying = true;
          toggleBtn.innerHTML = 'â¸';
          toggleBtn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
          console.log('éŸ³ä¹å¼€å§‹æ’­æ”¾:', tracks[currentTrack].getAttribute('data-name'));
        }).catch(error => {
          console.log('æ’­æ”¾å¤±è´¥:', error);
        });
      } else {
        // æç¤ºç”¨æˆ·å…ˆäº¤äº’
        const originalHTML = toggleBtn.innerHTML;
        toggleBtn.innerHTML = 'ğŸ‘†';
        toggleBtn.style.background = 'linear-gradient(135deg, #ffa726 0%, #ff9800 100%)';
        
        setTimeout(() => {
          toggleBtn.innerHTML = originalHTML;
          toggleBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }, 1000);
      }
    }
  });
  
  // ä¸Šä¸€é¦–/ä¸‹ä¸€é¦–
  prevBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    enableAudio();
    switchTrack(currentTrack - 1);
  });
  
  nextBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    enableAudio();
    switchTrack(currentTrack + 1);
  });
  
  // éŸ³é‡æ§åˆ¶
  volumeBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    enableAudio();
    
    if (music.volume > 0) {
      music.volume = 0;
      volumeBtn.innerHTML = 'ğŸ”‡';
      volumeBtn.title = 'éŸ³é‡: é™éŸ³';
    } else {
      music.volume = 0.3;
      volumeBtn.innerHTML = 'ğŸ”Š';
      volumeBtn.title = 'éŸ³é‡: 30%';
    }
  });
  
  // é¼ æ ‡æ‚¬åœæ•ˆæœ
  [toggleBtn, prevBtn, nextBtn, volumeBtn].forEach(btn => {
    btn.addEventListener('mouseenter', function() {
      this.style.transform = 'scale(1.1)';
    });
    
    btn.addEventListener('mouseleave', function() {
      this.style.transform = 'scale(1)';
    });
  });
  
  // éŸ³ä¹äº‹ä»¶å¤„ç†
  music.addEventListener('loadeddata', function() {
    console.log('éŸ³ä¹æ–‡ä»¶åŠ è½½æˆåŠŸ');
    music.volume = 0.3; // 30%éŸ³é‡
  });
  
  music.addEventListener('ended', function() {
    // å¾ªç¯æ’­æ”¾
    music.currentTime = 0;
    music.play();
  });
  
  music.addEventListener('error', function(e) {
    console.error('éŸ³ä¹åŠ è½½å¤±è´¥:', e);
    // è‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–
    setTimeout(() => {
      switchTrack(currentTrack + 1);
    }, 1000);
  });
  
  // åˆå§‹åŒ–ç¬¬ä¸€é¦–æ›²ç›®
  switchTrack(0);
  
  // é”®ç›˜å¿«æ·é”®
  document.addEventListener('keydown', function(e) {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
    
    switch(e.code) {
      case 'Space':
        e.preventDefault();
        toggleBtn.click();
        break;
      case 'ArrowLeft':
        e.preventDefault();
        prevBtn.click();
        break;
      case 'ArrowRight':
        e.preventDefault();
        nextBtn.click();
        break;
      case 'KeyM':
        e.preventDefault();
        volumeBtn.click();
        break;
    }
  });
  
  console.log('èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨å·²åŠ è½½å®Œæˆï¼');
  console.log('å¿«æ·é”®: ç©ºæ ¼=æ’­æ”¾/æš‚åœ, â†/â†’=åˆ‡æ¢æ›²ç›®, M=é™éŸ³');
});
</script>

<style>
/* éŸ³ä¹æ’­æ”¾å™¨å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  #music-controls {
    padding: 8px 12px !important;
  }
  #music-info {
    font-size: 10px !important;
  }
}

/* éŸ³ä¹æ’­æ”¾å™¨åŠ¨ç”» */
#music-player {
  animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* æ’­æ”¾æ—¶çš„è„‰åŠ¨æ•ˆæœ */
#music-toggle.playing {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
</style>
</body>

</html>
